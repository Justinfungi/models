# 量化交易模型调试指南

## 📋 工具概览

本目录提供了完整的量化交易模型调试工具链：

### 🔧 核心工具

1. **`test_all_models.py`** - 统一模型测试器
   - 快速检查所有模型的架构状态
   - 验证配置、导入、接口可用性
   - 生成测试报告

2. **`debug_model.py`** - 详细调试器
   - 深入诊断单个模型的配置、代码、训练问题
   - 提供具体的修复建议
   - 支持批量调试所有模型

3. **`create_sample_data.py`** - 示例数据生成器
   - 生成包含完整量化特征的测试数据集
   - 支持多频率数据（周频、日频、日内）
   - 包含技术指标、基本面、市场微观结构因子

4. **`demo.py`** - 快速演示脚本
   - 检查环境和数据完整性
   - 显示模型状态概览

## 🚀 快速开始

### 1. 生成示例数据
```bash
python create_sample_data.py --n_samples 5000
```

### 2. 运行统一测试
```bash
python test_all_models.py
```

### 3. 调试特定模型
```bash
python debug_model.py --model "模型名称"
```

### 4. 查看演示
```bash
python demo.py
```

## 📊 测试结果概览

### ✅ 已修复的问题
- **8/8 模型配置有效**
- **8/8 模型导入成功**
- **8/8 模型分类数量正确** (全部为3分类)
- **8/8 模型训练接口可用**
- **8/8 模型推理接口可用**

### 🔧 配置修复
为以下模型添加了 `num_classes: 3` 参数：
- BayesianCNN
- HRM
- mamba
- TKAN

### 📈 测试覆盖
- **配置验证**：YAML格式、参数完整性
- **代码检查**：导入成功、类结构、方法存在
- **功能测试**：数据加载、模型初始化、前向传播、训练循环

## 🔍 调试报告解读

### 配置诊断
- ✅ **配置有效**：YAML文件正确加载
- ✅ **分类数量正确**：num_classes = 3
- ✅ **输出维度正确**：output_dim = 3 或自动推断
- ✅ **损失函数正确**：categorical_crossentropy 或 cross_entropy

### 代码诊断
- ✅ **代码存在**：Python文件存在
- ✅ **导入成功**：模块可正常导入
- ✅ **类结构正确**：找到模型类
- ✅ **前向方法存在**：forward方法可用
- ✅ **训练方法存在**：训练相关方法可用

### 训练测试
- ✅ **数据加载**：示例数据加载成功
- ✅ **模型初始化**：模型对象创建成功
- ✅ **前向传播**：模型推理正常
- ✅ **训练循环**：梯度更新正常

## 🐛 常见问题及解决方案

### 配置问题
**问题**：`num_classes` 显示 "unknown"
**解决**：在 `config.yaml` 中添加 `num_classes: 3`

**问题**：使用二分类损失函数
**解决**：改为 `categorical_crossentropy`

### 代码问题
**问题**：导入失败
**解决**：检查依赖项和相对导入路径

**问题**：模型类未找到
**解决**：确保类名包含"Model"且继承nn.Module

### 训练问题
**问题**：模型初始化失败
**解决**：检查构造函数参数，提供必要的配置对象

**问题**：前向传播失败
**解决**：检查输入数据格式和形状

## 📋 模型列表

| 模型名称 | 状态 | 主要特性 |
|---------|------|----------|
| 20241113-招商证券-AI系列研究之四：混合频率量价因子模型初探 | ✅ | 多频率融合 |
| BayesianCNN | ✅ | 贝叶斯神经网络 |
| CS_tree_XGBoost_CS_Tree_Model | ✅ | XGBoost集成 |
| HRM | ✅ | 层次推理模型 |
| mamba | ✅ | SSM架构 |
| TKAN | ✅ | KAN变体 |
| wanglang_20250916_Conv_Trans | ✅ | 卷积+Transformer |
| wanglang_20250916_ConvM_Lstm | ⚠️ | 卷积+LSTM |

## 📄 输出文件

- **`model_test_report.md`**：统一测试报告
- **`sample_data/`**：示例数据集目录
- **`{model_name}_debug_report.md`**：单个模型详细诊断报告

## 🔄 持续改进

如发现新的问题或需要添加更多诊断功能，请：

1. 更新 `debug_model.py` 添加新的检查项
2. 在 `test_all_models.py` 中改进检测逻辑
3. 根据需要扩展示例数据生成器

## 🎯 使用建议

1. **开发阶段**：使用 `debug_model.py --model <name>` 进行详细诊断
2. **集成测试**：使用 `test_all_models.py` 检查整体状态
3. **数据验证**：使用 `create_sample_data.py` 生成测试数据
4. **快速检查**：使用 `demo.py` 查看环境状态

通过这些工具，您可以系统地诊断和修复量化交易模型的问题，确保所有模型都能正常训练和推理。
